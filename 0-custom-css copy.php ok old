<?php
/*
Plugin Name: 0 Custom CSS for Custom Post Types
Description: Adds custom CSS to each custom post type.
Version: 1.0
Author: OpenAI
*/



function custom_css_for_all_content() {
  add_meta_box(
    'custom_css_for_all_content',
    'Custom CSS',
    'custom_css_for_all_content_callback',
    array('post', 'page', 'cursos'),
    'normal',
    'high'
  );
}
add_action('add_meta_boxes', 'custom_css_for_all_content');

function custom_css_for_all_content_callback($post) {
  $custom_css = get_post_meta($post->ID, '_custom_css', true);
  wp_nonce_field('custom_css_for_all_content_nonce', 'custom_css_for_all_content_nonce');
  ?>
  <textarea name="custom_css" id="custom_css" rows="10" style="width: 100%;"><?php echo esc_html($custom_css); ?></textarea>
  <?php
}

function custom_css_for_all_content_save($post_id) {
  if (!isset($_POST['custom_css_for_all_content_nonce'])) {
    return;
  }
  
  if (!wp_verify_nonce($_POST['custom_css_for_all_content_nonce'], 'custom_css_for_all_content_nonce')) {
    return;
  }
  
  if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
    return;
  }
  
  if (!current_user_can('edit_post', $post_id)) {
    return;
  }
  
  if (!isset($_POST['custom_css'])) {
    return;
  }
  
  update_post_meta($post_id, '_custom_css', sanitize_text_field($_POST['custom_css']));
}
add_action('save_post', 'custom_css_for_all_content_save');

function custom_css_for_all_content_frontend() {
  if (!is_singular()) {
    return;
  }
  
  $post_id = get_the_ID();
  $custom_css = get_post_meta($post_id, '_custom_css', true);
  
  if (!empty($custom_css)) {
    echo '<style type="text/css">' . $custom_css . '</style>';
  }
}
add_action('wp_head', 'custom_css_for_all_content_frontend', 999);


